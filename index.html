<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Organizer (Powered by Groq)</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f2f5; padding: 20px; color: #333; }
        .container { max-width: 900px; margin: 0 auto; background: #fff; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        /* Tab Navigation */
        .tabs { display: flex; border-bottom: 2px solid #e0e0e0; margin-bottom: 20px; overflow-x: auto; }
        .tab-btn { padding: 12px 24px; cursor: pointer; border: none; background: none; font-weight: 600; color: #666; outline: none; transition: 0.3s; white-space: nowrap; }
        .tab-btn:hover { background-color: #f7f9fc; color: #f64c00; /* Groq Orangeish color hint */ }
        .tab-btn.active { border-bottom: 3px solid #f64c00; color: #f64c00; }

        /* Tab Content */
        .tab-content { display: none; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Forms & Inputs */
        label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.95em; }
        input[type="text"], input[type="password"], textarea { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 14px; transition: 0.3s; }
        input:focus, textarea:focus { border-color: #f64c00; outline: none; box-shadow: 0 0 0 3px rgba(246, 76, 0, 0.1); }
        textarea { height: 180px; font-family: 'Consolas', 'Monaco', monospace; line-height: 1.5; }
        
        /* Buttons */
        .btn-group { display: flex; gap: 10px; margin-bottom: 10px; }
        button { background-color: #f64c00; color: white; padding: 10px 24px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600; transition: 0.2s; display: inline-flex; align-items: center; justify-content: center; }
        button:hover { background-color: #d94300; transform: translateY(-1px); }
        button:disabled { background-color: #ccc; cursor: not-allowed; transform: none; }
        
        button.secondary { background-color: #4a5568; }
        button.secondary:hover { background-color: #2d3748; }

        /* Output & Utilities */
        .output-box { background: #fafafa; padding: 15px; border-radius: 6px; min-height: 100px; white-space: pre-wrap; font-family: 'Consolas', monospace; border: 1px solid #eee; color: #444; }
        .status-msg { font-size: 0.9em; margin-top: 5px; font-weight: 500; }
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid #f64c00; border-radius: 50%; width: 16px; height: 16px; animation: spin 1s linear infinite; margin-right: 10px; display: none; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div class="container">
    <h2 style="margin-top:0; color:#1a202c;">Video Metadata Tool <span style="font-size:0.6em; color:#f64c00; vertical-align:middle; border:1px solid #f64c00; padding:2px 6px; border-radius:4px;">Groq Edition</span></h2>

    <div class="tabs">
        <button class="tab-btn active" onclick="openTab(event, 'tab1')">1. API Key</button>
        <button class="tab-btn" onclick="openTab(event, 'tab2')">2. Input Data</button>
        <button class="tab-btn" onclick="openTab(event, 'tab3')">3. Hasil Bersih</button>
        <button class="tab-btn" onclick="openTab(event, 'tab4')">4. Input Path</button>
        <button class="tab-btn" onclick="openTab(event, 'tab5')">5. Output Final</button>
    </div>

    <div id="tab1" class="tab-content active">
        <label for="apiKeyInput">Groq API Key (gsk_...):</label>
        <div style="display:flex; gap:10px;">
            <input type="password" id="apiKeyInput" placeholder="Masukkan Key Groq Anda di sini...">
            <button onclick="toggleVisibility()" class="secondary" style="width: 50px;">üëÅÔ∏è</button>
        </div>
        <button onclick="saveApiKey()">Simpan API Key</button>
        <p class="status-msg" id="apiStatus">Status: Menunggu input...</p>
        <small style="color: #666;">Key disimpan di LocalStorage browser Anda (aman, tidak dikirim ke server saya).</small>
    </div>

    <div id="tab2" class="tab-content">
        <label for="rawInput">Data Mentah (Copy dari Videohive/Web):</label>
        <textarea id="rawInput" placeholder="Contoh:&#10;Loop 3d 5 2&#10;Updated 6 hours ago&#10;Loop 3d 12..."></textarea>
        
        <div class="btn-group">
            <button onclick="processWithGroq()" id="btnGroq">
                <div class="loader" id="loaderGroq"></div>
                Proses dengan Groq AI (Deteksi Cerdas)
            </button>
            
            <button class="secondary" onclick="processManual()">
                Proses Manual (Tanpa API)
            </button>
        </div>
        <p id="processStatus" class="status-msg"></p>
    </div>

    <div id="tab3" class="tab-content">
        <label>Daftar Nama Video (Bersih & Urut):</label>
        <textarea id="cleanOutput" readonly class="output-box" placeholder="Hasil akan muncul di sini..."></textarea>
        <p class="status-msg">Cek urutan di sini sebelum lanjut ke Tab 4.</p>
    </div>

    <div id="tab4" class="tab-content">
        <label for="pathInput">Masukkan Path File (Urutan Acak):</label>
        <textarea id="pathInput" placeholder="Paste daftar path file .mov Anda di sini..."></textarea>
        <button onclick="matchPaths()">Sesuaikan Path dengan Tab 3</button>
    </div>

    <div id="tab5" class="tab-content">
        <label>Path Final (Siap Copy):</label>
        <textarea id="finalOutput" readonly class="output-box"></textarea>
        <div class="btn-group">
            <button onclick="copyToClipboard()">Copy Semua</button>
            <button class="secondary" onclick="resetAll()">Reset Semua</button>
        </div>
    </div>
</div>

<script>
    // --- Global State ---
    let orderedNames = [];

    // --- Tab Functionality ---
    function openTab(evt, tabName) {
        let i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tab-content");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("tab-btn");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(tabName).style.display = "block";
        if (evt) evt.currentTarget.className += " active";
    }

    // --- TAB 1: API Key Logic ---
    window.onload = function() {
        const savedKey = localStorage.getItem('groqApiKey');
        if (savedKey) {
            document.getElementById('apiKeyInput').value = savedKey;
            document.getElementById('apiStatus').innerText = "‚úÖ API Key tersimpan.";
            document.getElementById('apiStatus').style.color = "green";
        }
    }

    function saveApiKey() {
        const key = document.getElementById('apiKeyInput').value.trim();
        if (key.startsWith("gsk_")) {
            localStorage.setItem('groqApiKey', key);
            document.getElementById('apiStatus').innerText = "‚úÖ API Key berhasil disimpan!";
            document.getElementById('apiStatus').style.color = "green";
        } else {
            alert("Format API Key sepertinya salah. Harus diawali 'gsk_'");
        }
    }

    function toggleVisibility() {
        const input = document.getElementById('apiKeyInput');
        input.type = input.type === "password" ? "text" : "password";
    }

    // --- TAB 2: Processing Logic (Groq & Manual) ---

    // 1. PROSES DENGAN GROQ API
    async function processWithGroq() {
        const apiKey = localStorage.getItem('groqApiKey');
        const rawText = document.getElementById('rawInput').value;

        if (!apiKey) { alert("Harap masukkan API Key di Tab 1 dulu!"); openTab(null, 'tab1'); return; }
        if (!rawText) { alert("Data input kosong!"); return; }

        // UI Loading
        const btn = document.getElementById('btnGroq');
        const loader = document.getElementById('loaderGroq');
        const status = document.getElementById('processStatus');
        
        btn.disabled = true;
        loader.style.display = "block";
        status.innerText = "Sedang menghubungi Groq...";

        // Konfigurasi Prompt AI
        const systemPrompt = `
        You are a precise data extraction tool.
        Task: Extract only the video title names from the user provided list.
        Rules:
        1. Remove any lines containing "Updated", dates, or timestamps.
        2. Keep the EXACT order of the video titles.
        3. Do not add numbering or bullet points.
        4. Output strictly the titles separated by newlines.
        `;

        try {
            const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                method: "POST",
                headers: {
                    "Authorization": `Bearer ${apiKey}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    messages: [
                        { role: "system", content: systemPrompt },
                        { role: "user", content: rawText }
                    ],
                    model: "llama3-8b-8192", // Model cepat dan efisien
                    temperature: 0.1 // Rendah agar hasil konsisten/faktual
                })
            });

            if (!response.ok) throw new Error(`Error API: ${response.status}`);

            const data = await response.json();
            const resultText = data.choices[0].message.content.trim();

            // Simpan ke variabel global dan tampilkan
            orderedNames = resultText.split('\n').map(s => s.trim()).filter(s => s !== "");
            document.getElementById('cleanOutput').value = orderedNames.join('\n');
            
            status.innerText = "‚úÖ Selesai! Mengalihkan ke Tab 3...";
            setTimeout(() => {
                document.querySelector('.tab-btn:nth-child(3)').click(); // Pindah Tab
                openTab(null, 'tab3');
            }, 1000);

        } catch (error) {
            console.error(error);
            status.innerText = "‚ùå Gagal: " + error.message;
            alert("Gagal memproses dengan Groq. Cek Console atau coba Proses Manual.");
        } finally {
            btn.disabled = false;
            loader.style.display = "none";
        }
    }

    // 2. PROSES MANUAL (Backup jika API Error)
    function processManual() {
        const rawText = document.getElementById('rawInput').value;
        const lines = rawText.split('\n');
        orderedNames = [];

        lines.forEach(line => {
            let clean = line.trim();
            // Logika sederhana: hapus baris yang mengandung 'Updated'
            if (clean && !clean.includes("Updated")) {
                orderedNames.push(clean);
            }
        });

        document.getElementById('cleanOutput').value = orderedNames.join('\n');
        document.querySelector('.tab-btn:nth-child(3)').click();
        openTab(null, 'tab3');
    }

    // --- TAB 4 & 5: Path Matching Logic ---
    function matchPaths() {
        const pathText = document.getElementById('pathInput').value;
        // Split berdasarkan baris baru atau koma
        let paths = pathText.split(/[\n,]+/).map(p => p.trim()).filter(p => p !== "");
        let finalPaths = [];

        if (orderedNames.length === 0) {
            alert("Data nama (Tab 3) masih kosong. Proses Tab 2 dulu.");
            return;
        }

        // Algoritma Fuzzy Match (JavaScript Local)
        orderedNames.forEach(name => {
            // Bersihkan nama target: hapus spasi, simbol, lowercase
            // "Loop 3d 5 8" -> "loop3d58"
            let target = name.toLowerCase().replace(/[^a-z0-9]/g, "");

            // Cari path yang mengandung string target
            let match = paths.find(path => {
                let pClean = path.toLowerCase().replace(/[^a-z0-9]/g, "");
                return pClean.includes(target);
            });

            if (match) {
                finalPaths.push(match);
            } else {
                finalPaths.push(`[PATH TIDAK DITEMUKAN: ${name}]`);
            }
        });

        document.getElementById('finalOutput').value = finalPaths.join('\n'); // Output per baris
        document.querySelector('.tab-btn:nth-child(5)').click();
        openTab(null, 'tab5');
    }

    function copyToClipboard() {
        const el = document.getElementById("finalOutput");
        el.select();
        navigator.clipboard.writeText(el.value);
        alert("Berhasil dicopy!");
    }

    function resetAll() {
        if(confirm("Hapus semua data input?")) {
            document.getElementById('rawInput').value = "";
            document.getElementById('cleanOutput').value = "";
            document.getElementById('pathInput').value = "";
            document.getElementById('finalOutput').value = "";
            orderedNames = [];
            document.querySelector('.tab-btn:nth-child(2)').click();
            openTab(null, 'tab2');
        }
    }
</script>

</body>
</html>
