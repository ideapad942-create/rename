<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Video Organizer (Manual Mode)</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f7f6; padding: 20px; color: #333; }
        .container { max-width: 950px; margin: 0 auto; background: #fff; padding: 25px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        
        /* Navigation */
        .tabs { display: flex; border-bottom: 2px solid #e0e0e0; margin-bottom: 20px; }
        .tab-btn { padding: 12px 20px; cursor: pointer; border: none; background: none; font-weight: 600; color: #777; outline: none; transition: 0.3s; }
        .tab-btn:hover { background-color: #f1f1f1; color: #007bff; }
        .tab-btn.active { border-bottom: 3px solid #007bff; color: #007bff; }

        /* Content */
        .tab-content { display: none; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Inputs */
        label { display: block; margin-bottom: 8px; font-weight: 700; color: #444; }
        textarea { width: 100%; height: 150px; padding: 12px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; font-family: 'Consolas', monospace; font-size: 13px; line-height: 1.4; }
        textarea:focus { border-color: #007bff; outline: none; }

        /* Buttons */
        button { background-color: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; font-weight: 600; }
        button:hover { background-color: #0056b3; }
        button.reset { background-color: #dc3545; float: right; }
        button.reset:hover { background-color: #a71d2a; }

        /* Tables & Lists for Visual Check */
        .preview-list { max-height: 200px; overflow-y: auto; background: #fafafa; border: 1px solid #eee; padding: 10px; margin-bottom: 10px; border-radius: 5px; font-family: monospace; font-size: 12px; }
        .preview-item { padding: 2px 5px; border-bottom: 1px solid #eee; }
        
        table.check-table { width: 100%; border-collapse: collapse; margin-bottom: 15px; font-size: 13px; }
        table.check-table th { background: #eee; text-align: left; padding: 8px; border: 1px solid #ddd; }
        table.check-table td { padding: 8px; border: 1px solid #ddd; }
        .match-ok { color: green; font-weight: bold; background-color: #e6fffa; }
        .match-fail { color: red; font-weight: bold; background-color: #ffe6e6; }
        
        .badge { background: #eee; padding: 2px 6px; border-radius: 4px; font-size: 0.8em; margin-left: 5px; }
    </style>
</head>
<body>

<div class="container">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2>Smart Video Organizer <span style="font-size:0.5em; color:#fff; background:#28a745; padding:3px 8px; border-radius:4px; vertical-align:middle;">Manual Mode</span></h2>
        <button class="reset" onclick="resetAll()">Reset Ulang</button>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="openTab(event, 'tab2')">1. Input Nama</button>
        <button class="tab-btn" onclick="openTab(event, 'tab3')">2. Cek Urutan</button>
        <button class="tab-btn" onclick="openTab(event, 'tab4')">3. Input Path File</button>
        <button class="tab-btn" onclick="openTab(event, 'tab5')">4. Hasil & Cek</button>
    </div>

    <div id="tab2" class="tab-content active">
        <label>Masukkan Data Mentah (Dari Videohive/Notepad):</label>
        <textarea id="rawInput" placeholder="Paste data Anda di sini...&#10;Loop 3d 5 2&#10;Updated 11 minutes ago&#10;Loop 3d 12..."></textarea>
        <button onclick="processNames()">Proses & Bersihkan</button>
        <span style="font-size: 0.9em; color:#666; margin-left:10px;">Script akan otomatis menghapus baris 'Updated...'</span>
    </div>

    <div id="tab3" class="tab-content">
        <label>Daftar Nama Video (Target Urutan):</label>
        <textarea id="cleanOutput" readonly placeholder="Hasil bersih akan muncul di sini..."></textarea>
        <div class="preview-list" id="countDisplayTab3">Jumlah item: 0</div>
    </div>

    <div id="tab4" class="tab-content">
        <label>Masukkan Path File (Penuh dengan folder & kutip):</label>
        <textarea id="pathInput" oninput="updatePathPreview()" placeholder='"G:\folder\file.mov"&#10;"G:\folder\file2.mov"'></textarea>
        
        <label>Preview Nama File (Path Folder Dihapus):</label>
        <div class="preview-list" id="pathPreviewBox" style="height: 150px; background: #fff; border:1px solid #ccc;">
            <i style="color:#999">Paste path di atas, nama file bersih akan muncul di sini...</i>
        </div>
        
        <div style="margin-top:10px;">
            <button onclick="matchPaths()">Sesuaikan Path dengan Urutan Tab 2</button>
        </div>
    </div>

    <div id="tab5" class="tab-content">
        <label>Tabel Pengecekan (Visual Verification):</label>
        <div style="max-height: 250px; overflow-y: auto; border: 1px solid #ddd; margin-bottom: 15px;">
            <table class="check-table" id="visualCheckTable">
                <thead>
                    <tr>
                        <th>No</th>
                        <th>Nama Target (Dari Tab 2)</th>
                        <th>Status</th>
                        <th>File Ditemukan (Dari Tab 3)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td colspan="4" style="text-align:center">Belum ada data diproses.</td></tr>
                </tbody>
            </table>
        </div>

        <label>Output Final (Full Path Berurutan - Siap Copy):</label>
        <textarea id="finalOutput" readonly style="height: 100px;"></textarea>
        <button onclick="copyToClipboard()">Copy Path Final</button>
    </div>
</div>

<script>
    let orderedNames = [];
    let fileDatabase = []; // Menyimpan objek { cleanName: "...", fullPath: "..." }

    function openTab(evt, tabName) {
        let i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tab-content");
        for (i = 0; i < tabcontent.length; i++) { tabcontent[i].style.display = "none"; }
        tablinks = document.getElementsByClassName("tab-btn");
        for (i = 0; i < tablinks.length; i++) { tablinks[i].className = tablinks[i].className.replace(" active", ""); }
        document.getElementById(tabName).style.display = "block";
        if(evt) evt.currentTarget.className += " active";
    }

    // --- TAB 1 & 2: Membersihkan Nama ---
    function processNames() {
        const raw = document.getElementById('rawInput').value;
        const lines = raw.split('\n');
        orderedNames = [];

        lines.forEach(line => {
            let clean = line.trim();
            // Hapus baris kosong dan baris yang mengandung "Updated" atau tanggal
            if (clean && !clean.includes("Updated") && !clean.match(/ago$/)) {
                orderedNames.push(clean);
            }
        });

        document.getElementById('cleanOutput').value = orderedNames.join('\n');
        document.getElementById('countDisplayTab3').innerText = "Jumlah item: " + orderedNames.length;
        
        // Auto pindah ke tab berikutnya
        document.querySelector('.tab-btn:nth-child(2)').click();
        openTab(null, 'tab3');
    }

    // --- TAB 3: Handle Input Path & Tampilan Bersih ---
    function updatePathPreview() {
        const rawInput = document.getElementById('pathInput').value;
        const lines = rawInput.split(/\r?\n/); // Split per baris
        const previewBox = document.getElementById('pathPreviewBox');
        
        fileDatabase = []; // Reset database sementara
        let previewHTML = "";

        lines.forEach(line => {
            let cleanLine = line.trim();
            if (cleanLine === "") return;

            // 1. Hapus tanda kutip (")
            let noQuotes = cleanLine.replace(/['"]+/g, '');
            
            // 2. Ambil nama file saja (hapus folder G:\...)
            // Menggunakan regex untuk memisahkan berdasarkan \ (Windows) atau / (Mac/Linux)
            let fileName = noQuotes.split(/[\\/]/).pop();

            if (fileName) {
                // Simpan ke database: Full Path (untuk output nanti) & File Name (untuk matching)
                fileDatabase.push({
                    fullPath: noQuotes,
                    fileName: fileName
                });
                previewHTML += `<div class="preview-item">ðŸ“„ ${fileName}</div>`;
            }
        });

        if (previewHTML === "") {
            previewBox.innerHTML = '<i style="color:#999">Paste path di atas...</i>';
        } else {
            previewBox.innerHTML = previewHTML;
        }
    }

    // --- TAB 4: Matching Logic & Visual Table ---
    function matchPaths() {
        if (orderedNames.length === 0) {
            alert("Harap proses nama di Tab 1 dulu.");
            return;
        }
        if (fileDatabase.length === 0) {
            // Jika user lupa, panggil updatePathPreview sekali lagi
            updatePathPreview();
            if (fileDatabase.length === 0) {
                alert("Harap masukkan path file di Tab 3.");
                return;
            }
        }

        const tableBody = document.querySelector("#visualCheckTable tbody");
        tableBody.innerHTML = ""; // Reset tabel
        
        let finalPaths = [];
        let matchCount = 0;

        orderedNames.forEach((targetName, index) => {
            // Normalisasi Target: "Loop 3d 5 2" -> "loop3d52"
            let normalizedTarget = targetName.toLowerCase().replace(/[^a-z0-9]/g, "");

            // Cari file yang cocok di database
            let match = fileDatabase.find(file => {
                // Normalisasi File: "Loop 3d 5_2.mov" -> "loop3d52mov"
                // Kita check apakah file "mengandung" target name
                let normalizedFile = file.fileName.toLowerCase().replace(/[^a-z0-9]/g, "");
                return normalizedFile.includes(normalizedTarget);
            });

            let row = document.createElement("tr");
            let statusCell = "";
            let fileCell = "";

            if (match) {
                finalPaths.push(match.fullPath); // Simpan path asli
                statusCell = `<td class="match-ok">OK</td>`;
                fileCell = `<td>${match.fileName}</td>`;
                matchCount++;
            } else {
                finalPaths.push(`[FILE TIDAK DITEMUKAN: ${targetName}]`);
                statusCell = `<td class="match-fail">MISSING</td>`;
                fileCell = `<td style="color:red; font-style:italic;">Tidak ada file yang cocok</td>`;
            }

            row.innerHTML = `
                <td>${index + 1}</td>
                <td>${targetName}</td>
                ${statusCell}
                ${fileCell}
            `;
            tableBody.appendChild(row);
        });

        // Isi textarea final
        document.getElementById('finalOutput').value = finalPaths.join('\n');
        
        // Pindah ke Tab 4
        document.querySelector('.tab-btn:nth-child(4)').click();
        openTab(null, 'tab5');
    }

    function copyToClipboard() {
        const el = document.getElementById("finalOutput");
        el.select();
        navigator.clipboard.writeText(el.value).then(() => {
            alert("Path berhasil dicopy!");
        });
    }

    function resetAll() {
        if(confirm("Reset semua input?")) {
            document.getElementById('rawInput').value = "";
            document.getElementById('cleanOutput').value = "";
            document.getElementById('pathInput').value = "";
            document.getElementById('finalOutput').value = "";
            document.getElementById('pathPreviewBox').innerHTML = "";
            document.querySelector("#visualCheckTable tbody").innerHTML = "";
            orderedNames = [];
            fileDatabase = [];
            document.querySelector('.tab-btn:nth-child(1)').click();
            openTab(null, 'tab2');
        }
    }
</script>

</body>
</html>
