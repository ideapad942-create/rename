<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Matcher (Filename Only + Counter)</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f7f6; padding: 20px; color: #333; }
        .container { max-width: 900px; margin: 0 auto; background: #fff; padding: 25px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        
        /* Tabs */
        .tabs { display: flex; border-bottom: 2px solid #ddd; margin-bottom: 20px; }
        .tab-btn { padding: 12px 20px; cursor: pointer; border: none; background: none; font-weight: 600; color: #777; outline: none; transition: 0.3s; }
        .tab-btn:hover { background-color: #f1f1f1; color: #007bff; }
        .tab-btn.active { border-bottom: 3px solid #28a745; color: #28a745; }

        /* Content */
        .tab-content { display: none; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Inputs & Textareas */
        label { display: block; margin-bottom: 8px; font-weight: 700; color: #444; }
        textarea { width: 100%; height: 150px; padding: 12px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; font-family: 'Consolas', monospace; font-size: 13px; }
        textarea:focus { border-color: #28a745; outline: none; }

        /* Buttons */
        button { background-color: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; font-weight: 600; margin-top: 5px; }
        button:hover { background-color: #0056b3; }
        
        button.success { background-color: #28a745; font-size: 16px; padding: 12px 25px; width: 100%; }
        button.success:hover { background-color: #218838; }

        button.reset { background-color: #dc3545; float: right; margin-top: 0; }
        button.reset:hover { background-color: #c82333; }

        /* Visual Table */
        table.check-table { width: 100%; border-collapse: collapse; margin-bottom: 15px; font-size: 13px; font-family: sans-serif; }
        table.check-table th { background: #eee; text-align: left; padding: 8px; border: 1px solid #ddd; }
        table.check-table td { padding: 8px; border: 1px solid #ddd; }
        .match-ok { color: #155724; background-color: #d4edda; font-weight: bold; text-align: center; }
        .match-fail { color: #721c24; background-color: #f8d7da; font-weight: bold; text-align: center; }

        /* Badge Counter Style */
        .count-badge {
            background-color: #28a745;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.85em;
            margin-left: 8px;
            display: inline-block;
            vertical-align: middle;
        }
    </style>
</head>
<body>

<div class="container">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2>Video Matcher <span style="font-size:0.5em; color:#fff; background:#28a745; padding:3px 8px; border-radius:4px; vertical-align:middle;">Nama File Only</span></h2>
        <button class="reset" onclick="resetAll()">Reset Semua</button>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="openTab(event, 'tab1')">1. Input Nama</button>
        <button class="tab-btn" onclick="openTab(event, 'tab2')">2. Cek Urutan</button>
        <button class="tab-btn" onclick="openTab(event, 'tab3')">3. Input Path</button>
        <button class="tab-btn" onclick="openTab(event, 'tab4')">4. Hasil Final</button>
    </div>

    <div id="tab1" class="tab-content active">
        <label>Masukkan Data Mentah (Nama + Updated...):</label>
        <textarea id="rawInput" placeholder="Loop 3d 5 2&#10;Updated 6 hours ago&#10;Loop 3d 12..."></textarea>
        <button onclick="processNames()">Proses Nama</button>
    </div>

    <div id="tab2" class="tab-content">
        <label>Hasil Nama Bersih (Cek Urutan di sini):</label>
        <textarea id="cleanOutput" readonly style="background:#f9f9f9; height: 200px;"></textarea>
        
        <button class="success" onclick="confirmOrder()">âœ… Urutan Sudah Sesuai -> Masuk ke Input Path</button>
    </div>

    <div id="tab3" class="tab-content">
        <label>Paste Path File Lengkap (Path "G:\" akan otomatis dibuang di output):</label>
        <textarea id="pathInput" placeholder='"G:\jey\envanto\Loop 3d 5_2.mov"&#10;"G:\jey\envanto\Loop 3d 12.mov"'></textarea>
        <button onclick="matchPaths()">Sesuaikan & Ambil Nama File</button>
    </div>

    <div id="tab4" class="tab-content">
        <label>Tabel Pengecekan:</label>
        <div style="max-height: 200px; overflow-y: auto; margin-bottom: 15px; border:1px solid #ddd;">
            <table class="check-table" id="visualCheckTable">
                <thead>
                    <tr>
                        <th>No</th>
                        <th>Target (Tab 2)</th>
                        <th>Status</th>
                        <th>File Ditemukan (Tab 3)</th>
                    </tr>
                </thead>
                <tbody><tr><td colspan="4">Menunggu proses...</td></tr></tbody>
            </table>
        </div>

        <label>Output Final (HANYA NAMA FILE - Siap Copy) <span id="finalCountBadge" class="count-badge" style="display:none;">0 File</span>:</label>
        
        <textarea id="finalOutput" readonly style="height: 120px; font-weight: bold; color: #000;"></textarea>
        <button class="success" onclick="copyToClipboard()">Copy Hasil</button>
    </div>
</div>

<script>
    let orderedNames = [];
    let fileDatabase = [];

    function openTab(evt, tabName) {
        let i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tab-content");
        for (i = 0; i < tabcontent.length; i++) { tabcontent[i].style.display = "none"; }
        tablinks = document.getElementsByClassName("tab-btn");
        for (i = 0; i < tablinks.length; i++) { tablinks[i].className = tablinks[i].className.replace(" active", ""); }
        document.getElementById(tabName).style.display = "block";
        if(evt) evt.currentTarget.className += " active";
    }

    // --- 1. PROSES NAMA ---
    function processNames() {
        const raw = document.getElementById('rawInput').value;
        const lines = raw.split('\n');
        orderedNames = [];

        lines.forEach(line => {
            let clean = line.trim();
            // Hapus baris 'Updated' atau tanggal
            if (clean && !clean.includes("Updated") && !clean.match(/ago$/)) {
                orderedNames.push(clean);
            }
        });

        document.getElementById('cleanOutput').value = orderedNames.join('\n');
        
        // Pindah ke Tab 2
        document.querySelector('.tab-btn:nth-child(2)').click();
        openTab(null, 'tab2');
    }

    // --- 2. KONFIRMASI URUTAN ---
    function confirmOrder() {
        if (orderedNames.length === 0) {
            alert("Data kosong! Silakan proses di Tab 1 dulu.");
            return;
        }
        // Langsung lompat ke Tab 3 (Input Path)
        document.querySelector('.tab-btn:nth-child(3)').click();
        openTab(null, 'tab3');
    }

    // --- 3. MATCHING & CLEANING PATH ---
    function matchPaths() {
        const pathText = document.getElementById('pathInput').value;
        // Split baris
        let paths = pathText.split(/\r?\n/).map(p => p.trim()).filter(p => p !== "");
        
        // Buat database file sementara
        fileDatabase = [];
        paths.forEach(fullPath => {
            // Bersihkan tanda kutip
            let cleanPath = fullPath.replace(/['"]+/g, '');
            // Ambil hanya nama file (buang G:\Folder\...)
            let fileName = cleanPath.split(/[\\/]/).pop();
            
            if (fileName) {
                fileDatabase.push({
                    original: cleanPath, // Masih disimpan jika butuh debug
                    nameOnly: fileName   // Ini yang akan kita pakai
                });
            }
        });

        if (orderedNames.length === 0) { alert("Urutan nama (Tab 2) kosong."); return; }
        if (fileDatabase.length === 0) { alert("Path file (Tab 3) kosong."); return; }

        const tableBody = document.querySelector("#visualCheckTable tbody");
        tableBody.innerHTML = "";
        
        let finalOutputList = [];

        orderedNames.forEach((targetName, index) => {
            // Normalisasi Target: "Loop 3d 5 2" -> "loop3d52"
            let normalizedTarget = targetName.toLowerCase().replace(/[^a-z0-9]/g, "");

            // Cari di database file
            let match = fileDatabase.find(file => {
                // Normalisasi File: "Loop 3d 5_2.mov" -> "loop3d52mov"
                let normalizedFile = file.nameOnly.toLowerCase().replace(/[^a-z0-9]/g, "");
                return normalizedFile.includes(normalizedTarget);
            });

            let row = document.createElement("tr");
            let statusHTML = "";
            let fileHTML = "";

            if (match) {
                // KUNCI: Kita ambil match.nameOnly (Nama Filenya saja), BUKAN full path
                finalOutputList.push(match.nameOnly);
                
                statusHTML = `<td class="match-ok">OK</td>`;
                fileHTML = `<td>${match.nameOnly}</td>`;
            } else {
                finalOutputList.push(`[MISSING: ${targetName}]`);
                statusHTML = `<td class="match-fail">X</td>`;
                fileHTML = `<td style="color:red">Tidak ditemukan</td>`;
            }

            row.innerHTML = `<td>${index + 1}</td><td>${targetName}</td>${statusHTML}${fileHTML}`;
            tableBody.appendChild(row);
        });

        // Tampilkan Hasil (Nama File Saja)
        document.getElementById('finalOutput').value = finalOutputList.join('\n');

        // --- UPDATE PENGHITUNG JUMLAH FILE ---
        const badge = document.getElementById('finalCountBadge');
        badge.style.display = 'inline-block';
        badge.innerText = finalOutputList.length + ' File';

        // Pindah ke Tab 4
        document.querySelector('.tab-btn:nth-child(4)').click();
        openTab(null, 'tab4');
    }

    function copyToClipboard() {
        const el = document.getElementById("finalOutput");
        el.select();
        navigator.clipboard.writeText(el.value).then(() => alert("Berhasil dicopy!"));
    }

    function resetAll() {
        if(confirm("Reset semua data?")) {
            document.getElementById('rawInput').value = "";
            document.getElementById('cleanOutput').value = "";
            document.getElementById('pathInput').value = "";
            document.getElementById('finalOutput').value = "";
            document.getElementById('finalCountBadge').style.display = "none"; // Reset badge
            document.querySelector("#visualCheckTable tbody").innerHTML = "";
            orderedNames = [];
            document.querySelector('.tab-btn:nth-child(1)').click();
            openTab(null, 'tab1');
        }
    }
</script>

</body>
</html>
